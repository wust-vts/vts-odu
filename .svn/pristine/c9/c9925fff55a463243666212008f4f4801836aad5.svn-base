using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Text;
using System.Windows.Forms;

namespace YimaEncNavigator
{
    public partial class Form_ShipInfoTinyBox : Form
    {
        public CShip m_ship;//船舶id
        public Form_ShipInfoTinyBox()
        {
            InitializeComponent();
        }

        private void Form_ShipInfoTinyBox_Load(object sender, EventArgs e)
        {
            InitFormStyle();
            this.m_ship = null;
            HiddenFormBox();
            this.Focus();
        }

        private void InitFormStyle()
        {
            this.FormBorderStyle = System.Windows.Forms.FormBorderStyle.FixedSingle;//不能修改大小
            this.ControlBox = false;//按钮不显示
            this.ShowInTaskbar = false;//不在底部栏显示
        }
        public void HiddenFormBox()
        {
            this.Location = new System.Drawing.Point(-1000, 0); 
        }

        public void SetShipObject(CShip ship,M_POINT mShowScrnPo, M_POINT mMouseGeoPo)
        {
            Point point = ((FormMain)this.Owner).GetLocationOnClient(((FormMain)this.Owner).ymEncCtrl);
            int iTop = point.Y;
            int iLeft = mShowScrnPo.x;
            this.Location = new System.Drawing.Point(iLeft, mShowScrnPo.y + iTop);
            this.m_ship = ship;
            RefrshShipInfo(ship, mMouseGeoPo);
        }

        public void RefrshShipInfo(CShip ship, M_POINT mMouseGeoPo)
        {
            double fShipLen = ship.shipType.shipLength;
            double fShipWidth = ship.shipType.shipWidth;
            string strShipName = ship.shipName;
            int iMmsi = ship.shipMMSI;

            double fValue = ship.shipCourse;
            double head = ship.shipHeading;
            double speed = ship.shipSpeed;
            int iTime = DateTime.Now.Minute;

            this.Text = strShipName.Trim();
            this.label_lon.Text = "经度:" + InteropEncDotNet.GetDegreeStringFromGeoCoor_new(true, mMouseGeoPo.x, 10000000, 3);
            this.label_lat.Text = "纬度:" + InteropEncDotNet.GetDegreeStringFromGeoCoor_new(false, mMouseGeoPo.y, 10000000, 3);
            this.label_head.Text = "航向:" + head.ToString("#0.00") + "(度)";
            this.label_speed.Text = "航速:" + speed.ToString("#0.000") + "(节)";
            this.label_length.Text = "船长:" + fShipLen.ToString("#0.0") + "(米)";
            this.label_width.Text = "船宽:" + fShipWidth.ToString("#0.0") + "(米)";
            this.label_time.Text = "时间:" + InteropEncDotNet.Int2DataTime(iTime).ToString(); ;

            //判断是否显示航迹
            if (ship.shipShowTrackOrNot)
            {
                this.button_showTrackOrNot.Text = "隐藏轨迹";
            }
            else
            {
                this.button_showTrackOrNot.Text = "显示轨迹";
            }
        }

        //显示/隐藏当前轨迹
        private void button_showTrackOrNot_Click(object sender, EventArgs e)
        {
            bool status = m_ship.shipShowTrackOrNot;
            if (status)
            {
                ((Button)sender).Text = "显示轨迹";
            }
            else
            {
                ((Button)sender).Text = "隐藏轨迹";
            }
            m_ship.shipShowTrackOrNot = !status;
            ((FormMain)this.Owner).RedrawMapScreen();//刷新海图
        }

        private void button_playTrack_Click(object sender, EventArgs e)
        {
            Form_SelectShipHistoryTrackInfoMan selectShipHistoryTrackInfoForm = new Form_SelectShipHistoryTrackInfoMan();
            selectShipHistoryTrackInfoForm.m_iCurShipId = m_ship.shipMMSI;
            selectShipHistoryTrackInfoForm.Owner = this.Owner;
            selectShipHistoryTrackInfoForm.Show();
            HiddenFormBox();
        }

        //private void button_follow_Click(object sender, EventArgs e)
        //{
        //    if (this.button_follow.Text.Equals("取消跟踪"))
        //    {
        //        ShipManClass.m_iCurFollowShipMmsi = -1;
        //        this.button_follow.Text = "船舶跟踪";
        //        ((FormMain)this.Owner).ymEncCtrl.RotateMapByScrnCenter(0);
        //    }
        //    else
        //    {
        //        int iShipPos = ((FormMain)this.Owner).ymEncCtrl.GetOtherVesselPosOfID(this.m_iShipId);
        //        float ShipLength = 0;
        //        float retShipBreath = 0;
        //        string retStrShipName = "";
        //        int mmsi = 0;
        //        string ExtArrts = "";
        //        ((FormMain)this.Owner).ymEncCtrl.GetOtherVesselBasicInfo(iShipPos, ref ShipLength, ref retShipBreath, ref retStrShipName, ref mmsi, ref ExtArrts);
        //        if (mmsi > 0)
        //        {
        //            ShipManClass.m_iCurFollowShipMmsi = mmsi;
        //            ShipManClass.m_iFollowType = 0;
        //            this.button_follow.Text = "取消跟踪";
        //            this.button_headFollow.Text = "船首向上";
        //        }                
        //    }
        //}

        //private void button_headFollow_Click(object sender, EventArgs e)
        //{
        //    if (this.button_headFollow.Text.Equals("取消向上"))
        //    {
        //        ShipManClass.m_iCurFollowShipMmsi = -1;
        //        this.button_headFollow.Text = "船首向上";

        //        ((FormMain)this.Owner).ymEncCtrl.RotateMapByScrnCenter(0);
        //    }
        //    else
        //    {
        //        int iShipPos = ((FormMain)this.Owner).ymEncCtrl.GetOtherVesselPosOfID(this.m_iShipId);
        //        float ShipLength = 0;
        //        float retShipBreath = 0;
        //        string retStrShipName = "";
        //        int mmsi = 0;
        //        string ExtArrts = "";
        //        ((FormMain)this.Owner).ymEncCtrl.GetOtherVesselBasicInfo(iShipPos, ref ShipLength, ref retShipBreath, ref retStrShipName, ref mmsi, ref ExtArrts);
        //        if (mmsi > 0)
        //        {
        //            ShipManClass.m_iCurFollowShipMmsi = mmsi;
        //            ShipManClass.m_iFollowType = 1;
        //            this.button_headFollow.Text = "取消向上";

        //            this.button_follow.Text = "跟踪船舶";
        //        }
        //    }
        //}
    }
}
